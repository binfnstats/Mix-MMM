---
title: "survival_analysis"
author: "Yuexi (Tracy) Chen"
date: "10/22/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


```{r survival}
library(survminer)
library(survival)

id_type <- "WXS"
#id_type <- "MSK"
#id_type <- "MSK-MSK"
#data_type <- "assignments"
data_type <- "exposures"
# Load data
tcga_ov <- read.csv(paste("/Users/yuexichen/Downloads/lrgr_file/mskfiles/sigma-part4-BRCA-wildtype-TCGA-OV-", id_type, "-survival-analysis-",  data_type, ".tsv", sep = ''),sep='\t')
# Specify data type: MSK, WXS or MSK-MSK
#new_binary_sig3 <- as.numeric(tcga_ov$exposure_sig3>0.8)
# Remove NAs
# 1 is censored and 2 is dead
tcga_ov <- tcga_ov[!(tcga_ov$survival_status == 0),]
# Fit survival curves
fit <- survfit(Surv(survival_days, survival_status) ~ binary_sig3, data = tcga_ov)
# Drawing curves
ggsurvplot(fit, conf.int = TRUE, pval = TRUE) + ggtitle(paste("Wildtype BRCA1/2: TCGA-OV-", id_type, "-",data_type, sep=''))
```

## Including Plots

You can also embed plots, for example:

```{r cox}
# Transform age to years
tcga_ov$age_year <- tcga_ov$age_days/365
fit2 <- coxph(Surv(survival_days, survival_status) ~ age_year +  binary_sig3 + clinical_stage , data=tcga_ov)
ggforest(fit2, data =tcga_ov)
```
```{r}
sum(tcga_ov$binary_sig3)
sum(tcga_ov$binary_sig3==0)
```
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
