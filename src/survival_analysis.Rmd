---
title: "survival_analysis"
author: "Yuexi (Tracy) Chen"
date: "10/22/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


```{r survival}
library(survminer)
library(survival)
ds_ratio <- 5
id_type <- c(paste0("-OV-ds",ds_ratio),paste0("-OV-ds",ds_ratio))
#id_type <- c(paste0("-OV-ds",ds_ratio),"-TCGA-OV")
part_id <- 1
percent <- 0
#part1-status-new-OV-ds2-OV-ds2-survival-analysis-assignments-10.tsv
# Load data
fname <- paste("/Users/yuexichen/Downloads/lrgr_file/mskfiles/part",part_id,"-status-new",id_type[1],id_type[2],"-survival-analysis-assignments-",percent,".tsv", sep = '')
#fname <- "/Users/yuexichen/Downloads/lrgr_file/mskfiles/group-status-new-OV-ds5-OV-ds5-survival-analysis-assignments-0.tsv"
tcga_ov <- read.csv(fname, sep='\t')
# Specify data type: MSK, WXS or MSK-MSK
# Remove NAs
# 1 is censored and 2 is dead
tcga_ov <- tcga_ov[!(tcga_ov$survival_status == 0),]
#tcga_ov <- tcga_ov[(!tcga_ov$status == "BRCA mutations") ,]
#new_binary_sig3 <- as.numeric(tcga_ov$exposure_sig3>0.2)
# Fit survival curves
tcga_ov$survival_years <- tcga_ov$survival_days/365

fit <- survfit(Surv(survival_years, survival_status) ~ binary_sig3, data = tcga_ov)
# Drawing curves
ggsurvplot(fit, conf.int = TRUE, pval = TRUE) + ggtitle("Kaplan_Meier curve of ovarian cancer patients") + xlab("Year")
#ggsave("~/Desktop/survivalplot2.pdf")
```

## Including Plots

You can also embed plots, for example:

```{r cox}

#tcga_ov <- tcga_ov[(!tcga_ov$status == "BRCA mutations") ,]
#tcga_ov <- tcga_ov[(!tcga_ov$status == "na"),]
age_year <- tcga_ov$age_days/365
expo_ls <- tcga_ov$exposure_sig3
expo_ls <- expo_ls[order(expo_ls)]
threshold <- expo_ls[as.integer(percent/100 * length(expo_ls))]
threshold <- 0
tcga_ov$new_bina <- as.numeric(tcga_ov$exposure_sig3>threshold)
fit2 <- coxph(Surv(survival_days, survival_status) ~ age_year + exposure_sig3  + clinical_stage , data=tcga_ov)

ggforest(fit2, data =tcga_ov)
#summary(fit2)
ggsave("~/Desktop/forestplot2.pdf")
```

```{r}
# Transform age to years
# Specify data type: MSK, WXS or MSK-MSK
sum(tcga_ov$binary_sig3==1)
#length(tcga_ov$binary_sig3)
#print(1-sum(tcga_ov$binary_sig3)/length(tcga_ov$binary_sig3))
```
Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
